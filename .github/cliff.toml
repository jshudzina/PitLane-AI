# git-cliff configuration for automatic CHANGELOG generation
# Documentation: https://git-cliff.org/docs/configuration

[changelog]
# Template for the changelog header
header = """
# Changelog\n
All notable changes to this project will be documented in this file.\n
The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).\n
"""

# Template for the changelog body
# Available variables:
# - version: The version number
# - message: The commit message
# - group: The commit group (e.g., Features, Bug Fixes)
body = """
{% if version %}\
    ## [{{ version | trim_start_matches(pat="v") }}] - {{ timestamp | date(format="%Y-%m-%d") }}
{% else %}\
    ## [Unreleased]
{% endif %}\
{% for group, commits in commits | group_by(attribute="group") %}
    ### {{ group | striptags | trim | upper_first }}
    {% for commit in commits %}
        - {% if commit.scope %}**{{ commit.scope }}**: {% endif %}{{ commit.message | upper_first }}\
    {% endfor %}
{% endfor %}\n
"""

# Template for the changelog footer
footer = """
<!-- generated by git-cliff -->
"""

# Remove the leading and trailing whitespace from the template
trim = true

[git]
# Parse conventional commits (https://www.conventionalcommits.org/)
conventional_commits = true

# Filter out commits that don't follow conventional commit format
filter_unconventional = true

# Process each line of a commit as an individual commit
split_commits = false

# Protect breaking changes from being skipped
protect_breaking_commits = false

# Filter out commits based on their message
filter_commits = false

# Regex for matching git tags
tag_pattern = "v[0-9].*"

# Skip tags that match this regex
skip_tags = ""

# Ignore tags that don't contain any commits
ignore_tags = ""

# Sort commits by oldest first
topo_order = false

# Sort commits by newest first
sort_commits = "newest"

# Limit the number of commits included in the changelog
# 0 = no limit
limit_commits = 0

[[git.commit_preprocessors]]
# Replace issue numbers with GitHub links
pattern = '\((\w+\s)?#([0-9]+)\)'
replace = "([#${2}](https://github.com/jshudzina/PitLane-AI/pull/${2}))"

# Breaking changes
[[git.commit_parsers]]
message = "^.*!:"
group = "Breaking Changes"

# Features
[[git.commit_parsers]]
message = "^feat"
group = "Features"

# Bug fixes
[[git.commit_parsers]]
message = "^fix"
group = "Bug Fixes"

# Performance improvements
[[git.commit_parsers]]
message = "^perf"
group = "Performance"

# Refactoring
[[git.commit_parsers]]
message = "^refactor"
group = "Refactoring"

# Documentation
[[git.commit_parsers]]
message = "^docs"
group = "Documentation"

# Styling
[[git.commit_parsers]]
message = "^style"
group = "Styling"

# Testing
[[git.commit_parsers]]
message = "^test"
group = "Testing"

# Build system
[[git.commit_parsers]]
message = "^build"
group = "Build"

# CI/CD
[[git.commit_parsers]]
message = "^ci"
group = "CI/CD"

# Chores (skip these)
[[git.commit_parsers]]
message = "^chore\\(release\\): prepare for"
skip = true

[[git.commit_parsers]]
message = "^chore\\(deps.*\\)"
skip = true

[[git.commit_parsers]]
message = "^chore\\(pr\\)"
skip = true

[[git.commit_parsers]]
message = "^chore\\(pull\\)"
skip = true

[[git.commit_parsers]]
message = "^chore: bump version"
skip = true

[[git.commit_parsers]]
message = "^chore"
group = "Miscellaneous"

# Reverts
[[git.commit_parsers]]
message = "^revert"
group = "Reverts"

[bump]
# Automatically determine the next version based on commits
features_always_bump_minor = true
breaking_always_bump_major = true
